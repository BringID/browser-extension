import { SimpleHandlerConfig } from '../types';
import { JsonValue } from 'type-fest'

type TBinanceKycResponse = {
  code: string;
  data: {
    userId: number;
    certificateInfo: {
      kycLevel: number;
    };
  };
};

export const BinanceKycHandlerConfig: SimpleHandlerConfig = {
  name: 'Binance KYC',
  request: {
    method: 'POST',
    urlPattern:
      'https://www.binance.com/bapi/kyc/v2/private/certificate/kyc-certificate/get-kyc-user-profile',
  },
  redirect: 'https://www.binance.com/en/my/dashboard',
  tlsnConfig: {
    serverDns: 'www.binance.com',
    maxSentData: 1032,
    maxRecvData: 24000,
  },
  replayRequestCfg: {
    headers: {
      custom: {
        'accept-encoding': 'identity',
        'content-type': 'application/json',
        'clienttype': 'web',
      },
      whitelist: [
        'csrftoken',
        'bnc-uuid'
      ],
      cookie: {
        whitelist: [
          'aws-waf-token',
          'p20t',
          'bnc-uuid',
          'd1og',
          'logined',
          'cr00',
          '__cuid',
          'BNC_FV_KEY',
          'BNC_FV_KEY_T',
          'BNC_FV_KEY_EXPIRE'
        ],
      },
    },
  },
  transcriptDisclose: [
    '/data/userId',
    '/data/certificateInfo/kycLevel'
  ],
  responseMiddleware: async (_, response: JsonValue) => {
    const { code, data } = response as TBinanceKycResponse;
    console.log({ code, data });

    if (code !== '000000') {
      return new Error('binance_data_not_found');
    }

    if (!data?.certificateInfo) {
      return new Error('binance_data_not_found');
    }

    if (data.certificateInfo.kycLevel < 2) {
      return new Error('binance_kyc_not_verified');
    }
  },
};




// "***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************"kycStatus":1*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************"jumioStatus":"PASS"*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************"currentKycLevel":"ADVANCED"*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************"userId":15323293*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************"